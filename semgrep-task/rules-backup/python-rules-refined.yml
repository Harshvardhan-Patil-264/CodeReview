rules:
  # ==========================================
  # PYTHON CODING STANDARDS & BEST PRACTICES
  # Only specific, non-vague rules that trigger reliably
  # ==========================================

  # Rule 1: Function Naming Convention (snake_case)
  - id: py-naming-function-snake-case
    pattern: |
      def $FUNC(...):
        ...
    metavariable-regex:
      metavariable: $FUNC
      regex: '^[A-Z].*|.*[A-Z].*'
    message: "Function names should use snake_case, not camelCase or PascalCase"
    languages: [python]
    severity: WARNING
    metadata:
      category: naming-convention
      subcategory: function-naming

  # Rule 2: Class Naming Convention (PascalCase)
  - id: py-naming-class-pascal-case
    pattern: |
      class $CLASS:
        ...
    metavariable-regex:
      metavariable: $CLASS
      regex: '^[a-z].*|.*_.*'
    message: "Class names should use PascalCase, not snake_case or camelCase"
    languages: [python]
    severity: WARNING
    metadata:
      category: naming-convention
      subcategory: class-naming

  # Rule 3: Constants Should Be UPPER_CASE
  - id: py-naming-constant-upper-case
    patterns:
      - pattern-either:
          - pattern: $CONST = $VALUE
          - pattern: $CONST = ...
      - pattern-inside: |
          class $CLASS:
            ...
      - metavariable-regex:
          metavariable: $CONST
          regex: '^[a-z].*'
      - pattern-not: def $FUNC(...)
      - pattern-not: self.$ATTR = ...
    message: "Class-level constants should use UPPER_CASE naming"
    languages: [python]
    severity: INFO
    metadata:
      category: naming-convention
      subcategory: constant-naming

  # Rule 4: Use Context Manager for File Operations
  - id: py-best-practice-use-with-for-files
    patterns:
      - pattern-either:
          - pattern: |
              $F = open(...)
              ...
          - pattern: |
              $F = open(...)
      - pattern-not-inside: |
          with open(...) as $F:
            ...
    message: "Use 'with open(...)' context manager instead of bare open() to ensure files are properly closed"
    languages: [python]
    severity: WARNING
    metadata:
      category: best-practice
      subcategory: resource-management

  # Rule 5: Prefer f-strings Over .format()
  - id: py-best-practice-prefer-f-strings
    pattern-either:
      - pattern: '"...".format(...)'
      - pattern: "'...'.format(...)"
    message: "Prefer f-strings over .format() for better readability and performance (Python 3.6+)"
    languages: [python]
    severity: INFO
    metadata:
      category: best-practice
      subcategory: string-formatting

  # Rule 6: Prefer f-strings Over % Formatting
  - id: py-best-practice-prefer-f-strings-over-percent
    pattern-either:
      - pattern: '"..." % ...'
      - pattern: "'...' % ..."
    message: "Prefer f-strings over % formatting for better readability"
    languages: [python]
    severity: INFO
    metadata:
      category: best-practice
      subcategory: string-formatting

  # Rule 7: Use List Comprehension Instead of map/filter with lambda
  - id: py-best-practice-list-comp-over-map-lambda
    pattern-either:
      - pattern: map(lambda $X, $LIST)
      - pattern: filter(lambda $X, $LIST)
    message: "Prefer list comprehension over map/filter with lambda for better readability"
    languages: [python]
    severity: INFO
    metadata:
      category: best-practice
      subcategory: functional-programming

  # Rule 8: Require Docstrings for Public Functions
  - id: py-documentation-function-docstring
    patterns:
      - pattern: |
          def $FUNC(...):
            $BODY
      - pattern-not: |
          def $FUNC(...):
            """..."""
            ...
      - pattern-not: |
          def $FUNC(...):
            '''...'''
            ...
      - metavariable-regex:
          metavariable: $FUNC
          regex: '^(?!_).*'
      - pattern-not: |
          def $FUNC(...):
            pass
      - pattern-not: |
          def $FUNC(...):
            return ...
      - pattern-not: |
          def $FUNC(...):
            raise ...
    message: "Public functions should have docstrings explaining their purpose, parameters, and return values"
    languages: [python]
    severity: INFO
    metadata:
      category: documentation
      subcategory: docstrings

  # Rule 9: Require Docstrings for Public Classes
  - id: py-documentation-class-docstring
    patterns:
      - pattern: |
          class $CLASS:
            $BODY
      - pattern-not: |
          class $CLASS:
            """..."""
            ...
      - pattern-not: |
          class $CLASS:
            '''...'''
            ...
      - metavariable-regex:
          metavariable: $CLASS
          regex: '^(?!_).*'
      - pattern-not: |
          class $CLASS:
            pass
    message: "Public classes should have docstrings explaining their purpose and usage"
    languages: [python]
    severity: INFO
    metadata:
      category: documentation
      subcategory: docstrings

  # Rule 10: Use Type Hints for Function Parameters
  - id: py-best-practice-type-hints-params
    patterns:
      - pattern: |
          def $FUNC($ARG, ...):
            ...
      - pattern-not: |
          def $FUNC($ARG: $TYPE, ...):
            ...
      - pattern-not: |
          def $FUNC(self, ...):
            ...
      - pattern-not: |
          def $FUNC(cls, ...):
            ...
      - metavariable-regex:
          metavariable: $FUNC
          regex: '^(?!__).*(?<!__)$'
    message: "Consider adding type hints to function parameters for better code documentation and IDE support"
    languages: [python]
    severity: INFO
    metadata:
      category: best-practice
      subcategory: type-hints

  # Rule 11: Use Type Hints for Return Values
  - id: py-best-practice-type-hints-return
    patterns:
      - pattern: |
          def $FUNC(...):
            ...
            return $VALUE
      - pattern-not: |
          def $FUNC(...) -> $TYPE:
            ...
      - metavariable-regex:
          metavariable: $FUNC
          regex: '^(?!__).*(?<!__)$'
    message: "Consider adding return type hints for better code documentation"
    languages: [python]
    severity: INFO
    metadata:
      category: best-practice
      subcategory: type-hints

  # Rule 12: Avoid Mutable Default Arguments
  - id: py-pitfall-mutable-default-args
    pattern-either:
      - pattern: |
          def $FUNC(..., $ARG=[], ...):
            ...
      - pattern: |
          def $FUNC(..., $ARG={}, ...):
            ...
      - pattern: |
          def $FUNC(..., $ARG=set(), ...):
            ...
    message: "Avoid mutable default arguments (list, dict, set). Use None and initialize inside function"
    languages: [python]
    severity: ERROR
    metadata:
      category: common-pitfall
      subcategory: mutable-defaults
      fix: "Use 'def func(arg=None): arg = arg or []' instead"
