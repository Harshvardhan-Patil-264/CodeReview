rules:
  # ==========================================
  # GO CODING STANDARDS & BEST PRACTICES
  # Only specific, non-vague rules that trigger reliably
  # ==========================================

  # Rule 1: Always Check Error Returns
  - id: go-best-practice-check-errors
    pattern: |
      $VAR, $ERR := $FUNC(...)
      ...
    pattern-not-inside: |
      $VAR, $ERR := $FUNC(...)
      if $ERR != nil {
        ...
      }
    message: "Always check error returns. Ignoring errors can lead to unexpected behavior"
    languages: [go]
    severity: ERROR
    metadata:
      category: error-handling

  # Rule 2: Use defer for Resource Cleanup
  - id: go-best-practice-defer-close
    patterns:
      - pattern-either:
          - pattern: |
              $VAR, $ERR := $FUNC(...)
              ...
              $VAR.Close()
          - pattern: |
              $VAR := $FUNC(...)
              ...
              $VAR.Close()
      - pattern-not-inside: |
          defer $VAR.Close()
    message: "Use defer for resource cleanup to ensure it happens even if function panics"
    languages: [go]
    severity: WARNING
    metadata:
      category: resource-management

  # Rule 3: Pass Context as First Parameter
  - id: go-best-practice-context-first-param
    patterns:
      - pattern: |
          func $FUNC(..., ctx context.Context, ...) {
            ...
          }
    message: "Context should be the first parameter of a function, not in the middle or end"
    languages: [go]
    severity: WARNING
    metadata:
      category: best-practice

  # Rule 4: Don't Use Panic for Normal Error Handling
  - id: go-best-practice-no-panic-for-errors
    pattern: |
      if $ERR != nil {
        panic($ERR)
      }
    message: "Don't use panic() for normal error handling. Return the error instead"
    languages: [go]
    severity: WARNING
    metadata:
      category: error-handling

  # Rule 5: Use Meaningful Variable Names (No Single Letters Except Loops)
  - id: go-naming-meaningful-names
    patterns:
      - pattern: |
          func $FUNC(..., $VAR $TYPE, ...) {
            ...
          }
      - metavariable-regex:
          metavariable: $VAR
          regex: '^[a-z]$'
      - pattern-not: |
          func $FUNC(..., i int, ...) {
            ...
          }
      - pattern-not: |
          func $FUNC(..., j int, ...) {
            ...
          }
    message: "Use meaningful variable names. Single-letter names should only be used for loop counters"
    languages: [go]
    severity: INFO
    metadata:
      category: naming-convention

  # Rule 6: Receiver Names Should Be Consistent
  - id: go-naming-receiver-consistency
    patterns:
      - pattern: |
          func ($RECV1 $TYPE) $METHOD1(...) {
            ...
          }
          ...
          func ($RECV2 $TYPE) $METHOD2(...) {
            ...
          }
      - metavariable-comparison:
          comparison: $RECV1 != $RECV2
    message: "Receiver names should be consistent across all methods of a type"
    languages: [go]
    severity: WARNING
    metadata:
      category: naming-convention

  # Rule 7: Use make() for Slices with Known Capacity
  - id: go-performance-make-with-capacity
    pattern: |
      $SLICE := []$TYPE{}
      for ... {
        $SLICE = append($SLICE, ...)
      }
    message: "Use make([]Type, 0, capacity) when you know the final size to avoid reallocations"
    languages: [go]
    severity: INFO
    metadata:
      category: performance

  # Rule 8: Don't Ignore Context Cancellation
  - id: go-best-practice-check-context-done
    patterns:
      - pattern: |
          for {
            ...
          }
      - pattern-inside: |
          func $FUNC(ctx context.Context, ...) {
            ...
          }
      - pattern-not-inside: |
          for {
            select {
            case <-ctx.Done():
              ...
            ...
            }
          }
    message: "Long-running loops should check ctx.Done() to respect cancellation"
    languages: [go]
    severity: WARNING
    metadata:
      category: context-handling

  # Rule 9: Use sync.WaitGroup for Goroutine Synchronization
  - id: go-best-practice-use-waitgroup
    patterns:
      - pattern: |
          go func() {
            ...
          }()
          ...
          time.Sleep(...)
    message: "Use sync.WaitGroup instead of time.Sleep() to wait for goroutines"
    languages: [go]
    severity: WARNING
    metadata:
      category: concurrency

  # Rule 10: Close Channels Only from Sender
  - id: go-best-practice-close-channel-sender
    pattern: |
      go func() {
        ...
        close($CHAN)
      }()
    message: "Only the sender should close a channel. Closing from receiver can cause panic"
    languages: [go]
    severity: WARNING
    metadata:
      category: concurrency

  # Rule 11: Use Struct Literals with Field Names
  - id: go-best-practice-named-struct-fields
    pattern: |
      $TYPE{$VAL1, $VAL2, ...}
    message: "Use named fields in struct literals for better readability and maintainability"
    languages: [go]
    severity: INFO
    metadata:
      category: best-practice

  # Rule 12: Avoid Empty Interface{} When Possible
  - id: go-best-practice-avoid-empty-interface
    pattern: |
      func $FUNC(..., $VAR interface{}, ...) {
        ...
      }
    message: "Avoid interface{} when possible. Use specific types or generics (Go 1.18+)"
    languages: [go]
    severity: INFO
    metadata:
      category: type-safety
